Component({externalClasses:["l-class","l-item-class"],behaviors:["wx://form-field"],properties:{urls:{type:Array,value:[]},count:{type:[String,Number],value:9},clear:{type:Boolean,value:!1,observer:function(e){e&&this.handleClear()}},size:{type:[String,Number],value:3},sizeType:{type:String,value:"original"},mode:{type:String,value:"aspectFit"},custom:{type:Boolean,value:!1},preview:{type:Boolean,value:!0},maxImageSize:{type:Number,value:1e7}},data:{showBtn:!0,tempFilePath:""},lifetimes:{attached:function(){const e=this.judgeNewOrOld();this.setData({newOrOld:e}),"old"==e&&console.warn("image-picker组件已经升级，建议使用最新版本，当前用法会在后续版本中暂停支持")}},methods:{handleClear(){let e=this.data.urls;this.setData({urls:[],clear:!1,showBtn:!0});let t={all:e,current:e};this.triggerEvent("linclear",t,{})},onPreviewTap(e){const t=e.currentTarget.dataset.index,a=this.data.urls;let l="",r=[];if("old"==this.data.newOrOld)l=this.data.urls[t],r=this.data.urls;else{l=this.data.urls[t].url;for(let e=0;e<a.length;e++)r.push(a[e].url)}let s={index:t,current:a[t],all:a};!0===this.data.preview&&wx.previewImage({current:l,urls:r}),this.triggerEvent("linpreview",s,{})},onAddTap(){const e=this,t=this.data.count-this.data.urls.length;if(0===t)return;const a=this.data.newOrOld;wx.chooseImage({count:t,sizeType:this.data.sizeType,sourceType:["album","camera"],success(t){let l=[];if("old"==a)l=t.tempFilePaths;else for(let a=0;a<t.tempFilePaths.length;a++)l.push({url:t.tempFilePaths[a],imageSize:t.tempFiles[a].size}),t.tempFiles[a].size>e.data.maxImageSize?l[a].overSize=!0:l[a].overSize=!1;const r=e.data.urls.concat(l);r.length===parseInt(e.data.count)&&e.setData({showBtn:!1}),e.setData({urls:r,value:r,tempFilePath:l});let s={current:l,all:r},i={};e.triggerEvent("linchange",s,i),e.triggerEvent("linpush",s,i);let n=[];for(let e=0;e<r.length;e++)r[e].overSize&&n.push(r[e]);if(n.length>0){let t={current:l,all:r,overSizeList:n};e.triggerEvent("linoversize",t,i)}}})},onDelTap(e){const t=e.currentTarget.dataset.index,a=this.data.urls,l=a[t],r=this.handleSplice(a,l);r.length<parseInt(this.data.count)&&this.setData({showBtn:!0}),this.setData({tempFilePath:l,urls:r,value:r});let s={index:t,current:l,all:r};this.triggerEvent("linremove",s,{})},handleSplice:(e,t)=>e.filter(e=>e!==t),judgeNewOrOld:function(){const e=this.data.urls;return 0!=e.length&&"object"!=typeof e[0]?"old":"new"}}});